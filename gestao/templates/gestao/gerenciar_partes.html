{% extends is_modal|yesno:"gestao/partials/_base_modal.html,gestao/base.html" %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<form id="gerenciarPartesForm" method="post" action="{% url 'gestao:gerenciar_partes' processo_pk=processo.pk %}" novalidate>
    {% csrf_token %}
    {{ formset.management_form }}

    {% if formset.non_form_errors %}
        <div class="alert alert-danger" role="alert">
            {% for error in formset.non_form_errors %}{{ error }}{% endfor %}
        </div>
    {% endif %}

    <div class="row g-3">
        <div id="form-container" class="d-none">
            {% for form in formset %}
                {% include 'gestao/partials/_form_parte_processo.html' with form_parte=form %}
            {% endfor %}
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success-subtle d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 text-success-emphasis">Polo Ativo (Autores)</h6>
                    <button type="button" class="btn btn-sm btn-success btn-add-parte" data-tipo="AUTOR"><i class="bi bi-plus-circle"></i> Adicionar Autor</button>
                </div>
                <div class="card-body" id="autores-list"></div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-danger-subtle d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 text-danger-emphasis">Polo Passivo (Réus)</h6>
                    <button type="button" class="btn btn-sm btn-danger btn-add-parte" data-tipo="REU"><i class="bi bi-plus-circle"></i> Adicionar Réu</button>
                </div>
                <div class="card-body" id="reus-list"></div>
            </div>
        </div>
    </div>

    <div id="empty-form-template" style="display: none;">
        {% with formset.empty_form as form %}
            {% include 'gestao/partials/_form_parte_processo.html' with form_parte=form %}
        {% endwith %}
    </div>

    <div class="modal-footer mt-4">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-primary" id="save-partes-btn">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Salvar Alterações
        </button>
    </div>
</form>
{% endblock %}